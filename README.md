# Лабораторная 3

* Цель работы: создание веб-сервиса в бэкенде нашей системы для использования его в SPA
* Порядок показа: Через insomnia/postman показать коллекцию 21 запросов, выполнить GET списка заявок (отфильтровать по дате формирования и статусу), GET черновой заявки, удалить введенную заявку (если есть), выполнить GET списка услуг (с фильтром), добавить новую услугу и отдельным методом к ней картинку, GET черновой заявки, добавить другую услугу, список услуг с заявкой-черновиком, посмотреть заявку (из 2 услуг), изменить поле м-м, изменить заявку, завершить введенную заявку (показать ошибку), сформировать заявку, завершить сформированную заявку (вычисление стоимости/доставки), зарегистрировать нового пользователя. Показать измененные данные через select, объяснить модели, сериализаторы.
* Контрольные вопросы: веб-сервис, REST, RPC, заголовки и методы HTTP, версии HTTP, HTTPS, OSI ISO
* Диаграмма классов с детализацией бэкенда (домены методов по url с интерфейсами, перечислить все методы, модели, таблицы БД) + insomnia/postman. Связи у моделей сделать по коду, 3 варианта: методы используют разные модели, модели используют другие модели, модели используют несколько таблиц
* Задание: Создание веб-сервиса со всей итоговой бизнес логикой (кроме авторизации), подключение его к БД и тестирование в insomnia/postman

Создание веб-сервиса для получения/редактирования данных из вашей БД. Требуется разработать все методы для реализации итоговой бизнес логики вашего приложения. Для изображений услуг использовать Minio.

**Требования к веб-сервису:**

Методы и url в API должны соответствовать REST. Для списка услуг (как в 1 лабораторной) и заявок (по статусу и диапазону даты формирования) нужно предусмотреть фильтрацию на бэкенде. Взаимодействие с БД через ORM. Не делать POST заявки. Записи в статусе удален на клиент не передаются.

Статусы нельзя менять с любого на любой: создатель удаляет и формирует черновик заявки, а модератор отклоняет и завершает сформированную заявку. В данной лабораторной пользователь создатель зафиксирован во всех методах - укажите его константой через функцию-singleton. Системные поля (ид, статусы, создатель и модератор, даты создания, формирования и завершения) передавать с клиента для изменения запрещено. Они вычисляются на бэкенде через авторизацию и бизнес-логику.

**Домен услуги:**

* GET список с фильтрацией
* GET одна запись
* POST добавление (без изображения)
* PUT изменение
* DELETE удаление. Удаление изображения встроено в метод удаления услуги
* POST добавления в заявку-черновик. Заявка создается пустой, указывается автоматически создатель, дата создания и статус, остальные поля указываются через PUT или смену статуса
* POST добавление изображения. Добавление изображения по id услуги, старое изображение заменяется/удаляется. minio только в этом методе и удалении! Название изображение генерируется на латинице

**Домен заявки:**

* GET иконки корзины (без входных параметров, ид заявки вычисляется). Возвращается id заявки-черновика этого пользователя и количество услуг в этой заявке
* GET список (кроме удаленных и черновика, поля модератора и создателя через логины) с фильтрацией по диапазону даты формирования и статусу
* GET одна запись (поля заявки + ее услуги). При получении заявки возвращется список ее услуг с картинками
* PUT изменения полей заявки по теме
* PUT сформировать создателем (дата формирования). Происходит проверка на обязательные поля
* PUT завершить/отклонить модератором. При завершить/отклонении заявки проставляется модератор и дата завершения. Одно из доп. полей заявки или м-м рассчитывается (реализовать формулу представленную в лаб-2) при завершении заявки (вычисление стоимости заказа, даты доставки в течении месяца, вычисления в м-м).
* DELETE удаление (дата формирования)

**Домен м-м:**

* DELETE удаление из заявки (без PK м-м)
* PUT изменение количества/порядка/значения в м-м (без PK м-м)

**Домен пользователь:**

* POST регистрация
* GET полей пользователя после аутентификации (для личного кабинета)
* PUT пользователя (личный кабинет)
* POST аутентификация
* POST деавторизация
